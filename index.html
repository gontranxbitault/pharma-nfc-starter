<!doctype html>
<html lang="fr" class="h-full">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="color-scheme" content="light dark" />
  <title>Pharmémo — Rappels neutres de traitement</title>
  <meta name="description" content="Ajoutez un rappel neutre de prise ou de renouvellement en un tap. Aucune donnée patient." />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&family=Plus+Jakarta+Sans:wght@700;800&display=swap" rel="stylesheet">
  <style>
    :root{
      /* Brand Pharmémo */
      --pharma:#047857;       /* primary green */
      --pharma-dark:#065F46;
      --pharma-light:#10B981; /* on dark bg */
      --hygie:#3558FF;        /* secondary accent */
      --hygie-dark:#1E3A8A;
      --mint:#9FE8C5;
      --ink:#0B1220; --slate:#5D6B82; --line:#E6EAF3;
      --bg:#F7FAFF; --bg-dark:#0F162B; --fg:#0C1120;
      --ring:rgba(53,88,255,.35);
    }
    @media (prefers-color-scheme: dark){
      :root{ --bg:#0F162B; --fg:#EAF0FF; --slate:#9AA5C4; --line:color-mix(in oklab, white 10%, transparent); }
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{margin:0;background:
      radial-gradient(1200px 700px at 80% -10%, rgba(53,88,255,.12), transparent 60%),
      radial-gradient(900px 600px at -10% 20%, rgba(159,246,210,.10), transparent 60%),
      var(--bg);
      color:var(--fg);
      font:16px/1.55 Inter, system-ui, -apple-system, "Segoe UI", Roboto, Ubuntu, sans-serif;
    }
    .wrap{max-width:1060px;margin:0 auto;padding:clamp(16px,4vw,40px)}
    header{display:grid;grid-template-columns:56px 1fr auto;gap:16px;align-items:center;margin-bottom:18px}
    .brandmark{width:56px;height:56px;border-radius:16px;display:grid;place-items:center;background:linear-gradient(135deg,var(--pharma),var(--mint));color:#fff;box-shadow:0 8px 30px rgba(0,0,0,.25)}
    .brand h1{font:800 clamp(22px,3.5vw,34px)/1.1 "Plus Jakarta Sans", Inter, system-ui, sans-serif;margin:0}
    .brand h1 .alt{font-weight:700;color:var(--pharma)}
    .brand p{margin:.25rem 0 0;color:var(--slate)}

    .notice{margin:10px 0 20px;background:linear-gradient(180deg, color-mix(in oklab, var(--bg) 95%, #000 0%), color-mix(in oklab, var(--bg) 88%, #000 6%));
      border:1px solid color-mix(in oklab, var(--line), #000 10%);border-radius:16px;padding:14px 16px;display:flex;gap:12px;align-items:flex-start}
    .notice p{margin:0;color:var(--slate)}

    .grid{display:grid;gap:18px;grid-template-columns:1fr}
    @media(min-width:880px){.grid{grid-template-columns:repeat(3,1fr)}}

    .card{position:relative;overflow:hidden;background:linear-gradient(180deg, color-mix(in oklab, var(--bg) 86%, #000 0%), color-mix(in oklab, var(--bg) 80%, #000 8%));
      border:1px solid color-mix(in oklab, var(--line), #000 15%);border-radius:22px;padding:18px;box-shadow:0 10px 40px rgba(0,0,0,.18)}
    .card::after{content:"";position:absolute;inset:auto -40% -40% auto;width:180px;height:180px;background:radial-gradient(70px 70px at 50% 50%, color-mix(in oklab, var(--pharma), transparent 55%), transparent);transform:rotate(20deg);opacity:.25;pointer-events:none}

    .title{display:flex;align-items:center;gap:10px;margin:2px 0 10px}
    .badge{font-size:12px;color:var(--slate);border:1px dashed color-mix(in oklab, var(--slate), #000 35%);padding:.2rem .5rem;border-radius:999px}

    .btns{display:flex;flex-wrap:wrap;gap:10px;margin-top:14px}
    .btn{appearance:none;border:1px solid transparent;border-radius:14px;padding:.78rem 1.05rem;font-weight:700;text-decoration:none;display:inline-flex;align-items:center;gap:.55rem;transition:.2s transform,.2s box-shadow,.2s border-color,.2s background}
    .btn:hover{transform:translateY(-1px)}
    .btn:focus-visible{outline:4px solid var(--ring);outline-offset:2px}
    .btn-primary{background:var(--pharma);color:#fff}
    .btn-primary:hover{background:var(--pharma-dark)}
    .btn-ghost{background:transparent;color:var(--fg);border-color:color-mix(in oklab, var(--fg), #000 75%)}
    .btn-small{padding:.55rem .75rem}

    .muted{color:var(--slate);font-size:13px}
    .foot{margin-top:20px;display:flex;gap:12px;align-items:center;justify-content:space-between;flex-wrap:wrap}

    .tweak{margin-top:12px;border-top:1px dashed color-mix(in oklab, var(--slate), #000 35%);padding-top:12px}
    details>summary{cursor:pointer;list-style:none;color:var(--slate)}
    details>summary::-webkit-details-marker{display:none}

    @media (prefers-reduced-motion:no-preference){.card{transition:transform .2s ease}.card:hover{transform:translateY(-2px)}}
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div class="brandmark" aria-hidden="true">
        <!-- Bol d'Hygie icon -->
        <svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
          <path d="M7 7c0-2.2 1.8-4 4-4s4 1.8 4 4-2 3-5 4c-2.5 1-3 2-3 3.5S8.8 17 11 17h7"/>
          <path d="M5 12h14c0 2.8-3.1 5-7 5s-7-2.2-7-5z"/>
          <path d="M12 17v4"/>
        </svg>
      </div>
      <div class="brand">
        <h1>Pharm<span class="alt">émo</span></h1>
        <p class="muted">Ajoutez un rappel neutre de traitement en 1 tap. Aucun identifiant, aucune donnée patient.</p>
      </div>
      <div></div>
    </header>

    <div class="notice" role="note" aria-label="Info confidentialité">
      <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true"><circle cx="12" cy="12" r="10"></circle><line x1="12" y1="8" x2="12" y2="12"></line><line x1="12" y1="16" x2="12.01" y2="16"></line></svg>
      <p>Intitulé des évènements : <strong>« Rappel : traitement »</strong> (ne mentionne jamais un médicament). Import direct Apple/Outlook (.ics) ou création via Google Calendar.</p>
    </div>

    <div class="grid" role="list">
      <!-- Quotidien -->
      <section class="card" role="listitem">
        <div class="title">
          <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>
          <h2 style="margin:0;font:800 20px/1.2 'Plus Jakarta Sans', Inter, system-ui,sans-serif">Rappel quotidien</h2>
          <span class="badge">08:00 (modifiable)</span>
        </div>
        <p class="muted">Évènement récurrent tous les jours. Vous pourrez ajuster l’heure après ajout.</p>
        <div class="btns">
          <a class="btn btn-primary" id="ics-daily" href="/ics/quotidien.ics" aria-label="Ajouter via fichier iCalendar">Ajouter (Apple / Outlook)</a>
          <a class="btn btn-primary" id="gcal-daily" href="#" aria-label="Ajouter via Google Calendar">Ajouter (Google Calendar)</a>
        </div>
        <details class="tweak">
          <summary>Optionnel : changer l’heure par défaut</summary>
          <div style="margin-top:10px;display:flex;gap:10px;align-items:center;flex-wrap:wrap">
            <label class="muted">Heure <input id="daily-hour" type="time" value="08:00" style="padding:.35rem .5rem;border-radius:8px;border:1px solid color-mix(in oklab, var(--fg), #000 80%);background:transparent;color:inherit"></label>
            <button class="btn btn-small btn-ghost" id="apply-daily">Mettre à jour les liens</button>
          </div>
        </details>
      </section>

      <!-- Biquotidien -->
      <section class="card" role="listitem">
        <div class="title">
          <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg>
          <h2 style="margin:0;font:800 20px/1.2 'Plus Jakarta Sans', Inter, system-ui,sans-serif">Rappel biquotidien</h2>
          <span class="badge">08:00 & 20:00</span>
        </div>
        <p class="muted">Deux rappels par jour. Le fichier .ics crée 2 évènements quotidiens (matin/soir). Pour Google Calendar, ajoutez <em>Matin</em> puis <em>Soir</em>.</p>
        <div class="btns">
          <a class="btn btn-primary" id="ics-bidaily" href="/ics/biquotidien.ics">Ajouter (Apple / Outlook)</a>
          <a class="btn btn-primary" id="gcal-bidaily-am" href="#">Google Calendar • Matin</a>
          <a class="btn btn-primary" id="gcal-bidaily-pm" href="#">Google Calendar • Soir</a>
        </div>
        <details class="tweak">
          <summary>Optionnel : changer les heures</summary>
          <div style="margin-top:10px;display:flex;gap:10px;align-items:center;flex-wrap:wrap">
            <label class="muted">Matin <input id="am-hour" type="time" value="08:00" style="padding:.35rem .5rem;border-radius:8px;border:1px solid color-mix(in oklab, var(--fg), #000 80%);background:transparent;color:inherit"></label>
            <label class="muted">Soir <input id="pm-hour" type="time" value="20:00" style="padding:.35rem .5rem;border-radius:8px;border:1px solid color-mix(in oklab, var(--fg), #000 80%);background:transparent;color:inherit"></label>
            <button class="btn btn-small btn-ghost" id="apply-bidaily">Mettre à jour</button>
          </div>
        </details>
      </section>

      <!-- Renouvellement -->
      <section class="card" role="listitem">
        <div class="title">
          <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true"><path d="M21 12a9 9 0 1 1-9-9v0"/><polyline points="22 12 18 12 15 15"/></svg>
          <h2 style="margin:0;font:800 20px/1.2 'Plus Jakarta Sans', Inter, system-ui,sans-serif">Rappel de renouvellement</h2>
          <span class="badge">Mensuel • alerte veille</span>
        </div>
        <p class="muted">Crée un rappel mensuel pour renouveler l’ordonnance (alerte la veille). L’ICS fourni a une date d’exemple ; vous pourrez modifier la date/heure après ajout.</p>
        <div class="btns">
          <a class="btn btn-primary" id="ics-renew" href="/ics/renouvellement.ics">Ajouter (Apple / Outlook)</a>
          <a class="btn btn-primary" id="gcal-renew" href="#">Ajouter (Google Calendar)</a>
        </div>
        <details class="tweak">
          <summary>Optionnel : démarrer à +1 mois, 09:00</summary>
          <div class="muted" style="margin-top:8px">Le lien Google calcule par défaut la première occurrence à +1 mois (heure 09:00). Vous pouvez ajuster ci‑dessous.</div>
          <div style="margin-top:10px;display:flex;gap:10px;align-items:center;flex-wrap:wrap">
            <label class="muted">Heure <input id="renew-hour" type="time" value="09:00" style="padding:.35rem .5rem;border-radius:8px;border:1px solid color-mix(in oklab, var(--fg), #000 80%);background:transparent;color:inherit"></label>
            <button class="btn btn-small btn-ghost" id="apply-renew">Mettre à jour</button>
          </div>
        </details>
      </section>
    </div>

    <div class="foot">
      <p class="muted">🔒 Intitulé neutre : « Rappel : traitement ». Aucune donnée patient.</p>
      <p class="muted">Astuce comptoir : QR code de secours si NFC désactivé.</p>
    </div>
  </div>

  <script>
    // ===== Utilities =====
    const pad = n => String(n).padStart(2,'0');
    // UTC stamp for Google (robust across TZ/DST): YYYYMMDDTHHMMSSZ
    const toUTCStamp = dt => `${dt.getUTCFullYear()}${pad(dt.getUTCMonth()+1)}${pad(dt.getUTCDate())}T${pad(dt.getUTCHours())}${pad(dt.getUTCMinutes())}${pad(dt.getUTCSeconds())}Z`;

    function nextAt(timeStr){
      const [h,m] = (timeStr||'08:00').split(':').map(Number);
      const now = new Date();
      const dt = new Date();
      dt.setHours(h, m||0, 0, 0);
      if (dt.getTime() < now.getTime()) dt.setDate(dt.getDate()+1);
      return dt;
    }

    function gcalTemplateURL({title, start, end, rrule, details, ctz}){
      const params = new URLSearchParams({ action: 'TEMPLATE', text: title });
      if (start && end) params.set('dates', `${start}/${end}`);
      if (rrule) params.set('recur', `RRULE:${rrule}`);
      if (details) params.set('details', details);
      if (ctz) params.set('ctz', ctz);
      return `https://calendar.google.com/calendar/render?${params.toString()}`;
    }

    // ===== Builders =====
    function updateDaily(){
      const hhmm = document.getElementById('daily-hour').value || '08:00';
      const startLocal = nextAt(hhmm);
      const endLocal = new Date(startLocal.getTime() + 10*60000);
      const url = gcalTemplateURL({
        title: 'Rappel : traitement',
        start: toUTCStamp(startLocal), end: toUTCStamp(endLocal),
        rrule: 'FREQ=DAILY', ctz: 'Europe/Paris'
      });
      document.getElementById('gcal-daily').href = url;
    }

    function updateBidaily(){
      const am = document.getElementById('am-hour').value || '08:00';
      const pm = document.getElementById('pm-hour').value || '20:00';
      const amStartLocal = nextAt(am), amEndLocal = new Date(amStartLocal.getTime()+10*60000);
      const pmStartLocal = nextAt(pm), pmEndLocal = new Date(pmStartLocal.getTime()+10*60000);
      document.getElementById('gcal-bidaily-am').href = gcalTemplateURL({
        title: 'Rappel : traitement',
        start: toUTCStamp(amStartLocal), end: toUTCStamp(amEndLocal),
        rrule: 'FREQ=DAILY', details: 'Rappel matin', ctz: 'Europe/Paris'
      });
      document.getElementById('gcal-bidaily-pm').href = gcalTemplateURL({
        title: 'Rappel : traitement',
        start: toUTCStamp(pmStartLocal), end: toUTCStamp(pmEndLocal),
        rrule: 'FREQ=DAILY', details: 'Rappel soir', ctz: 'Europe/Paris'
      });
    }

    function updateRenew(){
      const hhmm = document.getElementById('renew-hour').value || '09:00';
      const [h,m] = hhmm.split(':').map(Number);
      const now = new Date();
      const first = new Date(now);
      first.setMonth(first.getMonth()+1);
      first.setHours(h, m||0, 0, 0);
      const endLocal = new Date(first.getTime()+10*60000);
      document.getElementById('gcal-renew').href = gcalTemplateURL({
        title: 'Renouveler l’ordonnance',
        start: toUTCStamp(first), end: toUTCStamp(endLocal),
        rrule: 'FREQ=MONTHLY', details: 'Alerte la veille (Apple/Outlook via .ics).', ctz: 'Europe/Paris'
      });
    }

    // Init + actions
    updateDaily(); updateBidaily(); updateRenew();
    document.getElementById('apply-daily').addEventListener('click', (e)=>{ e.preventDefault(); updateDaily(); });
    document.getElementById('apply-bidaily').addEventListener('click', (e)=>{ e.preventDefault(); updateBidaily(); });
    document.getElementById('apply-renew').addEventListener('click', (e)=>{ e.preventDefault(); updateRenew(); });
  </script>
</body>
</html>
